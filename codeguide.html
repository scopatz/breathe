

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How It Works &mdash; Breathe v0.9.0 documentation</title>
    <link rel="stylesheet" href="static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/breathe.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="Breathe v0.9.0 documentation" href="index.html" />
    <link rel="next" title="Test Pages" href="testpages.html" />
    <link rel="prev" title="Contributing to Breathe" href="contributing.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Breathe v0.9.0 documentation</span></a></h1>
        <h2 class="heading"><span>How It Works</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="contributing.html">Contributing to Breathe</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="testpages.html">Test Pages</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="how-it-works">
<span id="codeguide"></span><h1>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h1>
<p>There are three main sections to Breathe: parser, finders and renderers.
Briefly:</p>
<blockquote>
<dl class="docutils">
<dt><strong>parser</strong></dt>
<dd>Responsible for reading the doxygen xml output and creating objects
representing the data. Found in <tt class="docutils literal"><span class="pre">breathe.parser</span></tt>.</dd>
<dt><strong>finders</strong></dt>
<dd>Responsible for finding reference objects within the output from the
parser. Found in <tt class="docutils literal"><span class="pre">breathe.finder</span></tt>.</dd>
<dt><strong>renderers</strong></dt>
<dd>Responsible for producing restructured text nodes to represent the objects
that the finders have found. The renderers generally descend through the
object hierarchies rendering the objects, their children, their children&#8217;s
children and so on. Found in <tt class="docutils literal"><span class="pre">breathe.renderer</span></tt>.</dd>
</dl>
</blockquote>
<div class="section" id="parser">
<h2>Parser<a class="headerlink" href="#parser" title="Permalink to this headline">¶</a></h2>
<p>The parsers job is to parse the doxygen xml output and create a hierarchy of
Python objects to represent the xml data.</p>
<div class="section" id="doxygen-xml-output">
<h3>Doxygen Xml Output<a class="headerlink" href="#doxygen-xml-output" title="Permalink to this headline">¶</a></h3>
<p>The xml output from doxygen comes in multiple files. There is always an
<tt class="docutils literal"><span class="pre">index.xml</span></tt> file which is a central reference point and contains a list of all
the other files that have been generated by doxygen and an indication of what
they contain.</p>
<p>For example, in <tt class="docutils literal"><span class="pre">examples/doxygen/func/xml</span></tt> directory, the <tt class="docutils literal"><span class="pre">index.xml</span></tt> file
contains:</p>
<div class="highlight-python"><pre>&lt;?xml version='1.0' encoding='UTF-8' standalone='no'?&gt;
&lt;doxygenindex xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd" version="1.7.2"&gt;
  &lt;compound refid="class_test" kind="class"&gt;&lt;name&gt;Test&lt;/name&gt;
    &lt;member refid="class_test_1a45b6a232a4499f8ce37062eab5451570" kind="function"&gt;&lt;name&gt;member&lt;/name&gt;&lt;/member&gt;
  &lt;/compound&gt;
  &lt;compound refid="func_8h" kind="file"&gt;&lt;name&gt;func.h&lt;/name&gt;
  &lt;/compound&gt;
&lt;/doxygenindex&gt;</pre>
</div>
<p>This suggests there is additional information about a class called <strong>Test</strong>
which has a function called <strong>member</strong>. Additionally there is some more
information about a file called <strong>func.h</strong>.</p>
<p>Now, the <tt class="docutils literal"><span class="pre">refid</span></tt> attribute on the <tt class="docutils literal"><span class="pre">compound</span></tt> xml nodes gives an indication
of where the additional information can be found. So for the <strong>Test</strong> class, we
should look in <tt class="docutils literal"><span class="pre">class_test.xml</span></tt>, which we get by simply appending <tt class="docutils literal"><span class="pre">.xml</span></tt> to
the <tt class="docutils literal"><span class="pre">refid</span></tt> value, and for the <strong>func.h</strong> file we should look in
<tt class="docutils literal"><span class="pre">func_8h.xml</span></tt>.</p>
<p>So the <tt class="docutils literal"><span class="pre">index.xml</span></tt> file is unique in its role and has its own structure which
is defined in the <tt class="docutils literal"><span class="pre">index.xsd</span></tt> file which you will also find in the same
directory. All the other files, the ones referenced by the <tt class="docutils literal"><span class="pre">index.xml</span></tt> file, follow
another structure. This is described in <tt class="docutils literal"><span class="pre">compound.xsd</span></tt> file so we call these
other files <strong>compound</strong> files. These are generally longer than the
<tt class="docutils literal"><span class="pre">index.xml</span></tt> file and contain all the specific information you might expect
from doxygen, including any documentation you added to your code as doxygen
markup.</p>
<p>Have a look at <tt class="docutils literal"><span class="pre">examples/doxygen/func/xml/class_test.xml</span></tt> for a fairly short
example.</p>
</div>
<div class="section" id="doing-the-parsing">
<h3>Doing the Parsing<a class="headerlink" href="#doing-the-parsing" title="Permalink to this headline">¶</a></h3>
<p>To get things up and running quickly, I have used the <a class="reference external" href="http://www.rexx.com/~dkuhlman/generateDS.html">generateDS</a> project to help create
classes to parse the doxygen xml output. The script automatically creates the
<tt class="docutils literal"><span class="pre">compound.py</span></tt>, <tt class="docutils literal"><span class="pre">compoundsuper.py</span></tt>, <tt class="docutils literal"><span class="pre">index.py</span></tt> and <tt class="docutils literal"><span class="pre">indexsuper.py</span></tt> files
that you can see inside <tt class="docutils literal"><span class="pre">breathe/parser/doxygen</span></tt>.</p>
<p>So what is the difference between <tt class="docutils literal"><span class="pre">index.py</span></tt> and <tt class="docutils literal"><span class="pre">indexsuper.py</span></tt>, and
<tt class="docutils literal"><span class="pre">compound.py</span></tt> and <tt class="docutils literal"><span class="pre">compoundsuper.py</span></tt>? These files allow us to separate the
bulk of the automatically generated code from the code changes we might want to
make. There are a large number of classes in the <tt class="docutils literal"><span class="pre">...super.py</span></tt> files and each
one has a basic derived class in the corresponding non-super files.</p>
<p>It is designed so that all the hard work done by the generated code is
done in the <tt class="docutils literal"><span class="pre">...super.py</span></tt> files and if we need to make changes we can do them
in the derived classes in the non-super files and if we ever need to regenerate
the code, we only regenerate the <tt class="docutils literal"><span class="pre">...super.py</span></tt> files and so we don&#8217;t lose our
changes in the process.</p>
<p>The end result is that for the parsing, we have written relatively little code,
but have a large amount automatically generated for us. This has only been done
once and it seems relatively unlikely that we&#8217;ll do it again. The entry points to
the parsing code is the <tt class="docutils literal"><span class="pre">parse</span></tt> functions at the bottom of the
<tt class="docutils literal"><span class="pre">breathe.parser.doxygen.compound</span></tt> and <tt class="docutils literal"><span class="pre">breathe.parser.doxygen.index</span></tt>.</p>
<p>I have never really examined the details of the parsing but you can see that
there is a class for each node type you are likely to find in the xml files. I
say &#8220;node type&#8221; instead of just &#8220;node&#8221; because different nodes can share the
same type and there is one class per type. For example, there are
<strong>detaileddescription</strong> nodes and <strong>briefdescription</strong> nodes which are both of
type <strong>descriptionType</strong>. If we look in <tt class="docutils literal"><span class="pre">breathe.parser.doxygen.compoundsuper</span></tt>
we see a <strong>descriptionType</strong> class and in
<tt class="docutils literal"><span class="pre">breathe.parser.doxygen.compound</span></tt> we see a <strong>descriptionTypeSub</strong> class which
is derived from <strong>descriptionType</strong>.</p>
</div>
<div class="section" id="our-changes">
<h3>Our Changes<a class="headerlink" href="#our-changes" title="Permalink to this headline">¶</a></h3>
<p>You&#8217;ll notice there are some classes in the non-super files that have some
additional code in them. This tends to be adjusting the <tt class="docutils literal"><span class="pre">buildChildren</span></tt> member
function in the derived class to extend or override the one in the
automatically generated base class.</p>
<p>We have to do this sometimes as it seems the original code we generated with
<tt class="docutils literal"><span class="pre">generateDS</span></tt> fails to construct the children of some classes. The
<tt class="docutils literal"><span class="pre">generateDS</span></tt> scripts uses the descriptions in the <tt class="docutils literal"><span class="pre">.xsd</span></tt> files to determine
what classes to generate and what nodes can be the children of other nodes. It
is possible that the doxygen <tt class="docutils literal"><span class="pre">.xsd</span></tt> files contain levels of abstraction that
the <tt class="docutils literal"><span class="pre">generateDS</span></tt> project did not cope with at the time I used it. It is
possible that newer versions would handle it better but for the moment I&#8217;m
content updating the derived classes to handle the cases I see missing.</p>
</div>
</div>
<div class="section" id="finders">
<h2>Finders<a class="headerlink" href="#finders" title="Permalink to this headline">¶</a></h2>
<p>The finder classes have a relatively small but important job of finding objects
in the hierarchy generated by the parsers. For example, when a user specifies a
particular class for the <a class="reference internal" href="directives.html#doxygenclass"><em>doxygenclass directive</em></a>, we use
the finder classes to go and find the object corresponding to that class.</p>
<p>In fact, if you look closely, it is the finders that use the parser entry points
to parse the xml and then find the objects. The finders also use <tt class="docutils literal"><span class="pre">Matcher</span></tt>
objects to actually figure out if they have found what they are looking for.</p>
<p>In the simplest case, the finder only has to find the root of the hierarchy for
the <a class="reference internal" href="directives.html#doxygenindex"><em>doxygenindex directive</em></a>. In the other cases, the
finder is given a <tt class="docutils literal"><span class="pre">MatcherStack</span></tt> and the level of the hierarchy it should be
aiming for. The <tt class="docutils literal"><span class="pre">MatcherStack</span></tt> is what is sounds like, a stack of <tt class="docutils literal"><span class="pre">Matcher</span></tt>
objects which are designed to match at different levels of the hierarchy,</p>
<div class="section" id="more-details-please">
<h3>More Details, Please<a class="headerlink" href="#more-details-please" title="Permalink to this headline">¶</a></h3>
<p>So initially, we create a finder to look at the root of the hierarchy: the
<strong>doxygenTypeSub</strong> node. That finder, handily called
<strong>DoxygenTypeSubItemFinder</strong> (you&#8217;ll notice a lot of that) looks through all the
child compound nodes of the <strong>doxygenTypeSub</strong> node and tries a compound-level
match against each of them and if something matches it creates a
<strong>CompoundTypeSubItemFinder</strong> to look further.</p>
<p>In turn, that checks each of its member child nodes with a member-level match
and if it finds one it creates a <strong>MemberTypeSubItemFinder</strong> (see the pattern?)
and that does another check. The interesting part is, if that is successful, the
<strong>CompoundTypeSubItemFinder</strong> finds the corresponding xml file that has more
information in it (remember <tt class="docutils literal"><span class="pre">refid</span> <span class="pre">+</span> <span class="pre">.xml</span></tt>?) and parses that and creates
another finder to start looking in there. This time it is a
<strong>DoxygenTypeSubItemFinder</strong> from the <tt class="docutils literal"><span class="pre">breathe.finder.doxygen.compound</span></tt>
module. And the search goes on until we find an object to return for rendering.</p>
<p>If the <strong>CompoundTypeSubItemFinder</strong> fails to find any deeper levels to match
against then it returns itself as it must be the target we&#8217;re interested in.</p>
<p>As stated, the job of the finder is to find a single node for the renderers to
starting rendering to restructured text. That is all the finder does.</p>
</div>
</div>
<div class="section" id="renderers">
<h2>Renderers<a class="headerlink" href="#renderers" title="Permalink to this headline">¶</a></h2>
<p>Finally, the bit that really does something we care about. Rendering is the art
of turning whatever object we&#8217;ve found in the hierarchy into restructured text
nodes. This almost invariably means most of its children as well.</p>
<p>Much like with the finder classes, we start off creating a renderer for a
particular parser object and then it looks at its children and uses the renderer
factory to create appropriate renderers for those objects and tells them to
render and they look at their object&#8217;s children and create appropriate renderers
for those and so on and so forth.</p>
<p>The node we start at is determined by the finder and ultimately by the user. The
whole process is kicked off by the <tt class="docutils literal"><span class="pre">Builder</span></tt> class, though it doesn&#8217;t really
do much. The aim of the renderers is to return a list of restructured text nodes
which is passed back to Sphinx to render into whatever you&#8217;re final output
format is.</p>
<p>There are two complicated bits here. All the different renderers and all the
different restructured text nodes.</p>
<div class="section" id="different-renderers">
<h3>Different Renderers<a class="headerlink" href="#different-renderers" title="Permalink to this headline">¶</a></h3>
<p>Just like with the parsers, there is one renderer per node type. In fact there
is one renderer class per parser class and they are named almost the same and
are designed to match up. The renderers look at the data on the instance
of the corresponding parser class that they have been given and grab the
interesting bits and return restructured text nodes.</p>
<p>For reference on what there is to render, you can look at the parser class
definitions or at the raw xml to see what attributes there are to render.
Sometimes if something isn&#8217;t appearing in the final output, it is because the
renderer isn&#8217;t returning an restructured text representation of it so the
rendering code needs to be updated, and sometimes it is because the parser
classes are not picking it up properly so both the parser and the renderer code
needs to be updated.</p>
<p>Given a little bit of time, you get used to chasing through the xml nodes,
the parser classes and the corresponding renderers to figure out where all the
information is ending up.</p>
</div>
<div class="section" id="restructured-text-nodes">
<h3>Restructured Text Nodes<a class="headerlink" href="#restructured-text-nodes" title="Permalink to this headline">¶</a></h3>
<p>We use the restructured text API as provided by the fabulous docutils project
and extended by Sphinx itself. For the most part, they are fairly straight
forward and they are certainly well named.</p>
<p>Unfortunately there are a lot of nodes and only certain ways of combining them.
It is also not always clear what arguments their constructs take. Whilst I&#8217;m
sure it would be possible to figure it out with time and the appropriate source
code, the use of them is not something I&#8217;ve found very well documented and my
code largely operates on a basis of trial and error.</p>
<p>One day I&#8217;m sure I&#8217;ll be enlightened, until then expect fairly naive code.</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="contributing.html">Contributing to Breathe</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="testpages.html">Test Pages</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2009-2010, Michael Jones.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>